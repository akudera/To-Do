var g=Object.defineProperty;var f=i=>{throw TypeError(i)};var v=(i,t,e)=>t in i?g(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var p=(i,t,e)=>v(i,typeof t!="symbol"?t+"":t,e),L=(i,t,e)=>t.has(i)||f("Cannot "+e);var n=(i,t,e)=>(L(i,t,"read from private field"),e?e.call(i):t.get(i)),m=(i,t,e)=>t.has(i)?f("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),E=(i,t,e,s)=>(L(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=e(a);fetch(a.href,o)}})();class I{constructor(t,e="",s=String(Date.now())){this.id=s,this.title=t,this.description=e}}var r,u,T,c,k,d;class y{constructor(t){m(this,r);m(this,u);m(this,T,{taskList:"[data-js-task-list]",modalTitle:"[data-js-modal-title]"});m(this,c,{closeModalBtn:"closeModal",modalInput:"modalInput",modalDescriptionInput:"modalDescriptionInput",createTaskBtn:"createTask",addTask:"addTask",searchInput:"searchInput",addTaskButton:"addTask",createTask:"createTask",editTaskButton:"editTask"});m(this,k,"todoTasks");m(this,d,[]);E(this,r,t),this.TaskListElement=document.querySelector(n(this,T).taskList),this.modalTitleInput=document.getElementById(n(this,c).modalInput),this.modalDescriptionInput=document.getElementById(n(this,c).modalDescriptionInput),this.searchInput=document.getElementById(n(this,c).searchInput),this.addTaskButton=document.getElementById(n(this,c).addTaskButton),this.modalTitle=document.querySelector(n(this,T).modalTitle),this.createTaskButton=document.getElementById(n(this,c).createTask),this.editTaskButton=document.getElementById(n(this,c).editTaskButton),this.TaskListElement.addEventListener("click",e=>{if(e.target.classList.contains("main__task-delete-button")){const s=n(this,d).findIndex(a=>String(a.id)===String(e.target.closest("[data-js-task]").dataset.id));s!==-1?this.deleteTask(e.target.closest("[data-js-task]"),s):console.warn(`Задача с ID ${e.target.parentElement.dataset.id} не найдена в массиве`);return}if(e.target.hasAttribute("data-js-task")||e.target.classList.contains("main__task-title")){const s=e.target.closest("[data-js-task]");this.editTaskMenu(s.querySelector(".main__task-title").textContent,this.getDescription(s.dataset.id),s.dataset.id)}}),this.bindAddTaskEnterEvent=this.addTaskEnterEvent.bind(this),this.bindEditTaskEnterEvent=this.editTaskEnterEvent.bind(this),this.modalTitleInput.addEventListener("keydown",this.bindAddTaskEnterEvent),this.createTaskButton.addEventListener("click",()=>{this.addTask()}),this.addTaskButton.addEventListener("click",()=>{this.attachAddEnterEvent(),this.editTaskButton.classList.add("hidden"),this.createTaskButton.classList.remove("hidden"),n(this,r).openModal(),this.modalTitleInput.focus()}),this.editTaskButton.addEventListener("click",e=>{e.preventDefault(),this.editTaskEvent(e,n(this,u))}),this.loadTasksFromLocalStorage(),this.renderTasks()}addTaskEnterEvent(t){t.key==="Enter"&&(t.preventDefault(),this.addTask())}editTaskEnterEvent(t){t.key==="Enter"&&(t.preventDefault(),this.editTaskEvent(t,n(this,u)))}attachAddEnterEvent(){this.modalTitleInput.removeEventListener("keydown",this.bindEditTaskEnterEvent),this.modalTitleInput.addEventListener("keydown",this.bindAddTaskEnterEvent)}attachEditEnterEvent(){this.modalTitleInput.removeEventListener("keydown",this.bindAddTaskEnterEvent),this.modalTitleInput.addEventListener("keydown",this.bindEditTaskEnterEvent)}deleteTask(t,e){n(this,d).splice(e,1),this.saveTasksToLocalStorage(),t.remove(),this.filterTasks(this.searchInput.value)}editTaskEvent(t,e){if(t.preventDefault(),this.modalTitleInput.value.trim()){const s=this.modalTitleInput.value.trim(),a=this.modalDescriptionInput.value.trim(),o=n(this,d).find(l=>String(e)===String(l.id));if(o){o.title=s,o.description=a,this.saveTasksToLocalStorage();const l=this.TaskListElement.querySelector(`[data-id="${e}"] .main__task-title`);l.textContent=s}this.modalTitleInput.value="",this.modalDescriptionInput.value="",this.searchInput.value="",n(this,r).closeModal()}else n(this,r).showError("Укажите заголовок задачи!"),this.modalTitleInput.focus();this.editTaskButton.classList.add("hidden")}loadTasksFromLocalStorage(){const t=localStorage.getItem(n(this,k));if(t)try{const e=JSON.parse(t);E(this,d,e.map(s=>new I(s.title,s.description,s.id)))}catch(e){console.error("Ошибка при парсинге задачи из LocalStorage:",e)}}saveTasksToLocalStorage(){localStorage.setItem(n(this,k),JSON.stringify(n(this,d)))}renderTasks(t=n(this,d)){t.length===0?this.TaskListElement.querySelector(".main__item--info")||(this.TaskListElement.innerHTML='<li class="main__item main__item--info">Список дел пока пуст.</li>'):(this.TaskListElement.innerHTML="",t.forEach(e=>{var s;(s=this.TaskListElement)==null||s.appendChild(this.createTaskElement(e))}))}getDescription(t){const e=n(this,d).find(s=>s.id===t);return(e==null?void 0:e.description)||""}editTaskMenu(t,e,s){E(this,u,s),this.attachEditEnterEvent(),this.createTaskButton.classList.add("hidden"),this.editTaskButton.classList.remove("hidden"),this.modalTitle.textContent="Редактировать задачу",this.modalTitleInput.value=t,this.modalDescriptionInput.value=e,n(this,r).openModal()}createTaskElement(t){const e=document.createElement("li");e.dataset.id=t.id,e.setAttribute("data-js-task",""),e.classList.add("main__item");const s=document.createElement("span");s.textContent=t.title,s.classList.add("main__task-title"),e.appendChild(s);const a=document.createElement("button");return a.classList.add("main__task-delete-button"),a.ariaLabel="Удалить задачу",a.title="Удалить задачу",e.appendChild(a),e}addTask(){var t,e,s;if(this.modalTitleInput.value.trim()){const a=this.modalTitleInput.value.trim(),o=this.modalDescriptionInput.value.trim(),l=new I(a,o);n(this,d).push(l),this.saveTasksToLocalStorage(),(t=this.TaskListElement)==null||t.appendChild(this.createTaskElement(l)),(s=(e=this.TaskListElement)==null?void 0:e.querySelector(".main__item--info"))==null||s.remove(),this.modalTitleInput.value="",this.modalDescriptionInput.value="",this.searchInput.value="",this.filterTasks(""),n(this,r).closeModal()}else n(this,r).showError("Укажите заголовок задачи!"),this.modalTitleInput.focus()}filterTasks(t){var s,a;if(!t){this.TaskListElement.querySelectorAll("li.hidden:not(.main__item--info)").forEach(o=>{o.classList.remove("hidden")}),(s=this.TaskListElement.querySelector("[data-js-not-found]"))==null||s.remove(),n(this,d).length===0&&(this.TaskListElement.querySelector(".main__item--info")||(this.TaskListElement.innerHTML='<li class="main__item main__item--info">Список дел пока пуст.</li>'));return}if(this.TaskListElement.querySelectorAll("li:not(.main__item--info)").length>0){const o=t.toLowerCase().trim();this.TaskListElement.querySelectorAll("li:not(.main__item--info)").forEach(l=>{l.textContent.toLowerCase().includes(o)?l.classList.remove("hidden"):l.classList.add("hidden")})}const e=this.TaskListElement.querySelectorAll("li:not(.main__item--info):not(.hidden)");if(e.length===0&&n(this,d).length!==0&&!this.TaskListElement.querySelector(".main__item--info")){const o=document.createElement("li");o.textContent="По вашему запросу ничего не найдено :(",o.classList.add("main__item","main__item--info"),o.setAttribute("data-js-not-found",""),this.TaskListElement.appendChild(o)}e.length>0&&((a=this.TaskListElement.querySelector("[data-js-not-found]"))==null||a.remove())}}r=new WeakMap,u=new WeakMap,T=new WeakMap,c=new WeakMap,k=new WeakMap,d=new WeakMap;class _{constructor(){p(this,"selectors",{modal:"[data-js-modal]",modalError:"[data-js-modal-error]",modalTitle:"[data-js-modal-title]"});p(this,"ids",{closeModalBtn:"closeModal",modalInput:"modalInput",modalDescriptionInput:"modalDescriptionInput"});p(this,"html",document.querySelector("html"));this.modalElement=document.querySelector(this.selectors.modal),this.errorMessageElement=document.querySelector(this.selectors.modalError),this.closeModalButton=document.getElementById(this.ids.closeModalBtn),this.modalTitleInput=document.getElementById(this.ids.modalInput),this.modalDescriptionInput=document.getElementById(this.ids.modalDescriptionInput),this.modalTitle=document.querySelector(this.selectors.modalTitle)}openModal(){this.modalElement.showModal(),this.html.classList.add("lock")}closeModal(){this.modalTitle.textContent="Новая задача",this.errorMessageElement.textContent="",this.modalTitleInput.value="",this.modalDescriptionInput.value="",this.modalElement.close(),this.html.classList.remove("lock")}showError(t){this.errorMessageElement.textContent=t}}const h=new _,S=new y(h),B=document.getElementById("searchInput");h.modalElement.addEventListener("mousedown",i=>{(i.target===h.modalElement||i.target===h.closeModalButton)&&h.closeModal()});h.closeModalButton.addEventListener("click",()=>{h.closeModal()});B.addEventListener("input",i=>{S.filterTasks(i.target.value)});
