var f=Object.defineProperty;var T=a=>{throw TypeError(a)};var v=(a,t,e)=>t in a?f(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e;var r=(a,t,e)=>v(a,typeof t!="symbol"?t+"":t,e),k=(a,t,e)=>t.has(a)||T("Cannot "+e);var d=(a,t,e)=>(k(a,t,"read from private field"),e?e.call(a):t.get(a)),h=(a,t,e)=>t.has(a)?T("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(a):t.set(a,e),u=(a,t,e,s)=>(k(a,t,"write to private field"),s?s.call(a,e):t.set(a,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();class p{constructor(t,e="",s=String(Date.now())){this.id=s,this.title=t,this.description=e}}var l,m;class g{constructor(t){h(this,l);r(this,"editTaskId");h(this,m);r(this,"ids",{closeModalBtn:"closeModal",modalInput:"modalInput",modalDescriptionInput:"modalDescriptionInput",searchInput:"searchInput",addTaskButton:"addTask",createTask:"createTask",saveEditChanges:"saveChanges"});r(this,"selectors",{taskList:"[data-js-task-list]",task:"[data-js-task]",taskWrapper:".main__item-wrapper",taskTitle:".main__item-title",modalTitle:"[data-js-modal-title]"});r(this,"tasks",[]);u(this,l,t),u(this,m,"todoTasks"),this.TaskListElement=document.querySelector(this.selectors.taskList),this.modalTitleInput=document.getElementById(this.ids.modalInput),this.modalDescriptionInput=document.getElementById(this.ids.modalDescriptionInput),this.searchInput=document.getElementById(this.ids.searchInput),this.addTaskButton=document.getElementById(this.ids.addTaskButton),this.modalTitle=document.querySelector(this.selectors.modalTitle),this.createTaskButton=document.getElementById(this.ids.createTask),this.saveEditChangesButton=document.getElementById(this.ids.saveEditChanges),this.bindEvents(),this.loadTasksFromLocalStorage(),this.renderTasks()}debounce(t,e=200){let s;return function(...n){clearTimeout(s),s=setTimeout(()=>{t.apply(this,n)},e)}}bindEvents(){this.TaskListElement.addEventListener("click",t=>{this.onTaskClick(t)}),this.bindAddTaskEnterEvent=this.addTaskEnterEvent.bind(this),this.bindEditTaskEnterEvent=this.editTaskEnterEvent.bind(this),this.modalTitleInput.addEventListener("keydown",this.bindAddTaskEnterEvent),this.createTaskButton.addEventListener("click",()=>{this.addTask()}),this.addTaskButton.addEventListener("click",()=>{this.onAddTaskBtnClick()}),this.saveEditChangesButton.addEventListener("click",t=>{this.onEditTaskBtnClick(t)})}onEditTaskBtnClick(t){t.preventDefault(),this.editTaskEvent(t,this.editTaskId)}onAddTaskBtnClick(){this.attachAddEnterEvent(),this.saveEditChangesButton.classList.add("hidden"),this.createTaskButton.classList.remove("hidden"),d(this,l).openModal(),this.modalTitleInput.focus()}onTaskClick(t){var e;if(t.target.matches(".main__item-delete-button")){const s=t.target.closest(this.selectors.task);if(!confirm(`Удалить задачу ${((e=s.querySelector(this.selectors.taskTitle))==null?void 0:e.textContent)||""} ?`))return;const i=this.tasks.findIndex(o=>String(o.id)===String(t.target.closest(this.selectors.task).dataset.id));i!==-1&&this.deleteTask(s,i);return}if(t.target.matches(this.selectors.taskWrapper)||t.target.matches(this.selectors.taskTitle)){const s=t.target.closest(this.selectors.task);this.editTaskMenu(s.querySelector(this.selectors.taskTitle).textContent,this.getDescription(s.dataset.id),s.dataset.id)}}addTaskEnterEvent(t){t.key==="Enter"&&(t.preventDefault(),this.addTask())}editTaskEnterEvent(t){t.key==="Enter"&&(t.preventDefault(),this.editTaskEvent(t,this.editTaskId))}attachAddEnterEvent(){this.modalTitleInput.removeEventListener("keydown",this.bindEditTaskEnterEvent),this.modalTitleInput.addEventListener("keydown",this.bindAddTaskEnterEvent)}attachEditEnterEvent(){this.modalTitleInput.removeEventListener("keydown",this.bindAddTaskEnterEvent),this.modalTitleInput.addEventListener("keydown",this.bindEditTaskEnterEvent)}deleteTask(t,e){this.tasks.splice(e,1),this.saveTasksToLocalStorage(),t.remove(),this.filterTasks(this.searchInput.value)}editTaskEvent(t,e){if(t.preventDefault(),this.modalTitleInput.value.trim()){const s=this.modalTitleInput.value.trim(),n=this.modalDescriptionInput.value.trim(),i=this.tasks.find(o=>String(e)===String(o.id));if(i){i.title=s,i.description=n,this.saveTasksToLocalStorage();const o=this.TaskListElement.querySelector(`[data-id="${e}"] ${this.selectors.taskTitle}`);o.textContent=s}this.modalTitleInput.value="",this.modalDescriptionInput.value="",this.searchInput.value="",d(this,l).closeModal()}else d(this,l).showError("Укажите заголовок задачи!"),this.modalTitleInput.focus();this.saveEditChangesButton.classList.add("hidden")}loadTasksFromLocalStorage(){const t=localStorage.getItem(d(this,m));if(t)try{const e=JSON.parse(t);this.tasks=e.map(s=>new p(s.title,s.description,s.id))}catch(e){console.error("Ошибка при парсинге задачи из LocalStorage:",e)}}saveTasksToLocalStorage(){localStorage.setItem(d(this,m),JSON.stringify(this.tasks))}renderTasks(t=this.tasks){t.length===0?this.TaskListElement.querySelector(".main__item--info")||(this.TaskListElement.innerHTML='<li class="main__item main__item--info">Список дел пока пуст.</li>'):(this.TaskListElement.innerHTML="",t.forEach(e=>{var s;(s=this.TaskListElement)==null||s.append(this.createTaskElement(e))}))}getDescription(t){const e=this.tasks.find(s=>s.id===t);return(e==null?void 0:e.description)||""}editTaskMenu(t,e,s){this.editTaskId=s,this.attachEditEnterEvent(),this.createTaskButton.classList.add("hidden"),this.saveEditChangesButton.classList.remove("hidden"),this.modalTitle.textContent="Редактировать задачу",this.modalTitleInput.value=t,this.modalDescriptionInput.value=e,d(this,l).openModal()}createTaskElement(t){const e=document.createElement("li");e.dataset.id=t.id,e.setAttribute("data-js-task",""),e.classList.add("main__item");const s=document.createElement("div");s.classList.add("main__item-wrapper"),e.append(s);const n=document.createElement("span");n.textContent=t.title,n.classList.add("main__item-title"),s.append(n);const i=document.createElement("button");return i.classList.add("main__item-delete-button"),i.ariaLabel="Удалить задачу",i.title="Удалить задачу",s.append(i),e}addTask(){var t,e,s;if(this.modalTitleInput.value.trim()){const n=this.modalTitleInput.value.trim(),i=this.modalDescriptionInput.value.trim(),o=new p(n,i);this.tasks.unshift(o),this.saveTasksToLocalStorage(),(t=this.TaskListElement)==null||t.prepend(this.createTaskElement(o)),(s=(e=this.TaskListElement)==null?void 0:e.querySelector(".main__item--info"))==null||s.remove(),this.modalTitleInput.value="",this.modalDescriptionInput.value="",this.searchInput.value="",this.filterTasks(""),d(this,l).closeModal()}else d(this,l).showError("Укажите заголовок задачи!"),this.modalTitleInput.focus()}filterTasks(t){var s,n;if(!t){this.TaskListElement.querySelectorAll("li.hidden:not(.main__item--info)").forEach(i=>{i.classList.remove("hidden")}),(s=this.TaskListElement.querySelector("[data-js-not-found]"))==null||s.remove(),this.tasks.length===0&&(this.TaskListElement.querySelector(".main__item--info")||(this.TaskListElement.innerHTML='<li class="main__item main__item--info">Список дел пока пуст.</li>'));return}if(this.TaskListElement.querySelectorAll("li:not(.main__item--info)").length>0){const i=t.toLowerCase().trim();this.TaskListElement.querySelectorAll("li:not(.main__item--info)").forEach(o=>{o.textContent.toLowerCase().includes(i)?o.classList.remove("hidden"):o.classList.add("hidden")})}const e=this.TaskListElement.querySelectorAll("li:not(.main__item--info):not(.hidden)");if(e.length===0&&this.tasks.length!==0&&!this.TaskListElement.querySelector(".main__item--info")){const i=document.createElement("li");i.textContent="По вашему запросу ничего не найдено :(",i.classList.add("main__item","main__item--info"),i.setAttribute("data-js-not-found",""),this.TaskListElement.append(i)}e.length>0&&((n=this.TaskListElement.querySelector("[data-js-not-found]"))==null||n.remove())}}l=new WeakMap,m=new WeakMap;class I{constructor(){r(this,"selectors",{modal:"[data-js-modal]",modalError:"[data-js-modal-error]",modalTitle:"[data-js-modal-title]"});r(this,"ids",{closeModalBtn:"closeModal",modalInput:"modalInput",modalDescriptionInput:"modalDescriptionInput"});r(this,"html",document.querySelector("html"));this.modalElement=document.querySelector(this.selectors.modal),this.errorMessageElement=document.querySelector(this.selectors.modalError),this.closeModalButton=document.getElementById(this.ids.closeModalBtn),this.modalTitleInput=document.getElementById(this.ids.modalInput),this.modalDescriptionInput=document.getElementById(this.ids.modalDescriptionInput),this.modalTitle=document.querySelector(this.selectors.modalTitle)}openModal(){this.modalElement.showModal(),this.html.classList.add("lock")}closeModal(){this.modalTitle.textContent="Новая задача",this.errorMessageElement.textContent="",this.modalTitleInput.value="",this.modalDescriptionInput.value="",this.modalElement.close(),this.html.classList.remove("lock")}showError(t){this.errorMessageElement.textContent=t}}const c=new I,E=new g(c),L=document.getElementById("searchInput");c.modalElement.addEventListener("mousedown",a=>{(a.target===c.modalElement||a.target===c.closeModalButton)&&c.closeModal()});c.closeModalButton.addEventListener("click",()=>{c.closeModal()});L.addEventListener("input",E.debounce(a=>E.filterTasks(a.target.value)));
